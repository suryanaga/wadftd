const H="2cf443c";console.log("ðŸ“¦ Script version (initial):",H);document.addEventListener("DOMContentLoaded",function(){["pledgeSection2","pledgeSection3","pledgeSection4"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.add("pledge-section-disabled","pledge-section-overlay")});const S={"Future Dharma":"https://cdn.prod.website-files.com/66cdebdbbd868704132ec32f/673c805ce322ad4e4f4a0c5e_FD-logo_icon--coloured--250px.png","Order Office":"https://cdn.prod.website-files.com/66cdebdbbd868704132ec32f/673c809e757d3f3b9e945446_kesa%20emblem.png"},B={International:"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/672c93a99c106ad5d0006ad0_Warm%20Gradient%20Abstract%20ALT.avif",Local:"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/6728c5be93d6a63d4475aa46_Painting%203%20new.avif","Retreat/GFR":"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/67322b0aeb4ef255c66d5694_Painted%201.avif"};document.getElementById("email-form-2").addEventListener("keydown",e=>{e.key==="Enter"&&e.preventDefault()});function q(){if(!document.getElementById("max-charity-error")){const e=document.createElement("div");e.id="max-charity-error",e.className="text-size-medium text-align-center padding-small",Object.assign(e.style,{color:"white",backgroundColor:"#f85050",marginTop:"10px"}),e.textContent="You cannot add more than 7 charities. Please remove one before adding another.",document.getElementById("dragHeading")?.insertAdjacentElement("afterend",e)}}function C(){document.getElementById("max-charity-error")?.remove()}document.getElementById("calcBtn1").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection2").classList.remove("pledge-section-disabled","pledge-section-overlay");const t=document.getElementById("currencySelector").value;localStorage.setItem("selectedCurrency",t),F(t);const o=parseFloat(document.getElementById("monthlyIncome").value);if(isNaN(o)||o<=0)return alert("Please enter a valid monthly income.");let n=Math.round(o/21.67*2)/2;localStorage.setItem("dailyIncome",n.toFixed(2)),document.getElementById("s2-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s2-head").click(),document.getElementById("oneDayForYou").textContent=`${t}${n.toFixed(2)}`,h("1-Day",n,"1 Day",t),h("Half-Day",n/2,"1/2 Day",t),h("1.5-Days",n*1.5,"1.5 Days",t),h("2-Days",n*2,"2 Days",t);const c=document.getElementById("1-Day");c&&c.click(),document.getElementById("radio").checked||E("Order Office")});function F(e){document.querySelectorAll(".amount-money, .total-gift-amount, #oneDayForYou, .w-form-label").forEach(t=>{t.textContent=t.textContent.replace(/[$â‚¬â‚¹Â£]/g,e)})}function h(e,t,o,n){const c=Math.round(t*2)/2,l=document.getElementById(e),a=document.querySelector(`span[for='${e}']`);l&&a&&(l.dataset.amount=c,a.textContent=`${o} (${n}${c.toFixed(2)})`)}document.getElementById("calcBtn2").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection3").classList.remove("pledge-section-disabled","pledge-section-overlay");const t=document.querySelector("input[name='radioDayChoice']:checked");if(!t)return alert("Please select an amount to give.");const o=parseFloat(t.getAttribute("data-amount"));if(isNaN(o))return alert("Invalid amount selected. Please try again.");const n=document.getElementById("allocation-bar");if(!n){console.error("Element with ID 'allocation-bar' not found.");return}n.innerHTML="",n.dataset.totalAmount=o;const c=document.querySelector('input[type="checkbox"][data-item-name="Future Dharma"]');if(console.log("FD checkbox found?",c),c?(c.checked=!0,c.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0}))):console.warn("Couldn't find Future Dharma checkbox â€“ check your data-item-name!"),document.getElementsByName("radio")[0]?.checked){const a=document.querySelector('input[type="checkbox"][data-item-name="Order Office"]');a&&(a.checked=!0,a.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})))}v(),document.getElementById("s3-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s3-head").click()}),document.getElementById("calcBtn3").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection4").classList.remove("pledge-section-disabled","pledge-section-overlay");const t=document.getElementById("allocation-bar"),o=parseFloat(t.dataset.totalAmount);if(isNaN(o)||o<=0)return alert("Invalid pledge amount. Please ensure you have selected an amount to give.");const n=document.querySelectorAll(".allocation-section");if(n.length===0)return alert("Please add at least one charity to allocate your gift.");let l=`
      <p>You are pledging to give <strong>${localStorage.getItem("selectedCurrency")||"Â£"}${o.toFixed(2)}</strong> each month, split across:</p>
      <table class="pledge-summary-table">
        <tr>
          <th>Charity</th>
          <th>Amount</th>
        </tr>`;const a=document.getElementById("wf-form-WADFTD-Pledge-Form-Final");if(!a){console.error("Pledge form not found!");return}document.querySelectorAll(".pledge-hidden-input").forEach(s=>s.remove());const d=document.createElement("input");d.type="hidden",d.name="TotalGift",d.value=o.toFixed(2),d.classList.add("pledge-hidden-input"),a.appendChild(d);let i=1;n.forEach(s=>{const y=s.querySelector(".allocator--charity-name").textContent.trim(),g=s.querySelector(".amount-money").textContent.trim();l+=`
        <tr>
          <td>${y}</td>
          <td>${g}</td>
        </tr>`;const u=document.createElement("input");u.type="hidden",u.name=`Charity${i}Name`,u.value=y,u.classList.add("pledge-hidden-input"),a.appendChild(u);const m=localStorage.getItem("selectedCurrency")||"Â£",r=document.createElement("input");r.type="hidden",r.name=`Charity${i}Amount`,r.value=g.replace(/[$â‚¬â‚¹Â£]/g,m),r.classList.add("pledge-hidden-input"),a.appendChild(r),i++}),l+="</table>",document.getElementById("pledge-summary").innerHTML=l,document.getElementById("s4-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s4-head").click()});function D(e){const t=e.value.toLowerCase();e.closest(".searchbar--container").querySelector(".autocomplete--list-container")?.querySelectorAll(".autocomplete--item").forEach(n=>{n.style.display=n.dataset.itemName.toLowerCase().includes(t)?"flex":"none"})}document.querySelectorAll(".searchbar").forEach(e=>{e.addEventListener("input",()=>D(e))}),document.querySelectorAll(".searchbar").forEach(e=>{const o=e.closest(".searchbar--container").querySelector(".autocomplete--list-container");function n(){o.style.maxHeight=o.scrollHeight+"px"}e.addEventListener("focus",n),e.addEventListener("click",n)}),document.addEventListener("click",e=>{e.target.closest(".searchbar--container")||document.querySelectorAll(".autocomplete--list-container").forEach(t=>t.style.maxHeight="0")}),document.querySelectorAll(".autocomplete--checkbox").forEach(e=>e.addEventListener("change",$));function $(e){const t=e.target,o=t.dataset.itemName,c=t.closest(".autocomplete--list-container")?.dataset.charityType||null;t.checked?N(o,c):E(o)}function L(e){return e.replace(/\W+/g,"")}function N(e,t){const o=document.getElementById("allocation-bar");if(!o)return console.error("Allocation bar not found");if(o.querySelectorAll(".allocation-section").length>=7){q(),document.querySelector(`.autocomplete--checkbox[data-item-name="${e}"]`).checked=!1;return}C();const c=L(e);if(document.getElementById(`charity-${c}`))return;let l="";S[e]?l=`background-image:url('${S[e]}');`:t&&B[t]&&(l=`background-image:url('${B[t]}'); background-size:cover; background-position:center;`);const a=document.createElement("div");a.className="allocation-section",a.id=`charity-${c}`,a.innerHTML=`
      <div class="bar-slider--portion" style="${l}"></div>
      <div class="amounts-container">
        <div class="amount-percent text-size-medium center-this"></div>
        <div class="amount-money  text-size-medium center-this"></div>
        <a class="remove-charity w-button" data-charity-id="${e}">Remove</a>
      </div>
      <div class="allocator--charity-name">${e}</div>
    `,o.appendChild(a),v(),k()}function E(e){const t=L(e);document.getElementById(`charity-${t}`)?.remove();const o=document.querySelector(`.autocomplete--checkbox[data-item-name="${e}"]`);o&&(o.checked=!1),C(),v(),k()}document.getElementById("allocation-bar").addEventListener("click",function(e){if(e.target.classList.contains("remove-charity")){const t=e.target.dataset.charityId;E(t);const o=document.querySelector(`.autocomplete--checkbox[data-item-name="${t}"]`);o&&(o.checked=!1)}});function v(){console.log("ðŸ”„ updateTotal fired; sections =",document.querySelectorAll(".allocation-section").length);const e=document.getElementById("allocation-bar");parseFloat(e.dataset.totalAmount);const t=[...e.querySelectorAll(".allocation-section")];if(!t.length)return;let o=Math.round(100/t.length*100)/100,n=100-o*t.length;t.forEach((c,l)=>{let a=o;n>0?(a++,n--):n<0&&(a--,n++),c.style.width=a+"%",b(c)}),T()}function k(){console.log("ðŸ”§ rebuildBoundaryHandles invoked");const e=document.getElementById("allocation-bar");e.querySelectorAll(".boundary-handle").forEach(n=>n.remove());const t=[...e.querySelectorAll(".allocation-section")];if(t.length<2)return;let o=0;t.forEach((n,c)=>{const l=parseFloat(n.style.width)||0;if(o+=l,c<t.length-1){const a=document.createElement("div");a.className="boundary-handle",a.dataset.leftIndex=c,a.dataset.rightIndex=c+1,a.style.left=o+"%",e.appendChild(a)}}),P()}function M(){const e=document.getElementById("allocation-bar"),t=[...e.querySelectorAll(".allocation-section")],o=[...e.querySelectorAll(".boundary-handle")];let n=0;t.forEach((c,l)=>{const a=parseFloat(c.style.width)||0;n+=a,o[l]&&(o[l].style.left=n+"%")})}function P(){document.querySelectorAll(".boundary-handle").forEach(e=>{e.removeEventListener("mousedown",f),e.removeEventListener("touchstart",f),e.addEventListener("mousedown",f),e.addEventListener("touchstart",f,{passive:!1})})}function f(e){e.preventDefault();const t=e.target,o=document.getElementById("allocation-bar"),n=o.offsetWidth,c=+t.dataset.leftIndex,l=+t.dataset.rightIndex,a=[...o.querySelectorAll(".allocation-section")],d=a[c],i=a[l];let s=parseFloat(d.style.width)||0,y=parseFloat(i.style.width)||0;const g=s+y,u=(e.type==="touchstart"?e.touches[0]:e).clientX;function m(p){p.preventDefault();const A=((p.type==="touchmove"?p.touches[0]:p).clientX-u)/n*100;let I=Math.max(1,s+A),x=Math.max(1,y-A);const w=g/(I+x);I*=w,x*=w,d.style.width=I.toFixed(2)+"%",i.style.width=x.toFixed(2)+"%",b(d),b(i),M()}function r(){document.removeEventListener("mousemove",m),document.removeEventListener("touchmove",m),document.removeEventListener("mouseup",r),document.removeEventListener("touchend",r)}document.addEventListener("mousemove",m,{passive:!1}),document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("mouseup",r),document.addEventListener("touchend",r)}function b(e){const t=document.getElementById("allocation-bar"),o=parseFloat(t.dataset.totalAmount)||0,n=localStorage.getItem("selectedCurrency")||"Â£",c=Math.round(parseFloat(e.style.width)||0),l=Math.round(c/100*o*2)/2;e.querySelector(".amount-percent").textContent=`${c}%`,e.querySelector(".amount-money").textContent=`${n}${l.toFixed(2)}`}function T(){const e=document.getElementById("allocation-bar"),t=parseFloat(e.dataset.totalAmount)||0,o=localStorage.getItem("selectedCurrency")||"Â£";document.querySelector(".total-gift-amount").textContent=`${o}${t.toFixed(2)}`}});
