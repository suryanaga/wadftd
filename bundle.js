const H="663d8d5";console.log("ðŸ“¦ Script version (initial):",H);document.addEventListener("DOMContentLoaded",function(){["pledgeSection2","pledgeSection3","pledgeSection4"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.add("pledge-section-disabled","pledge-section-overlay")});const C={"Future Dharma":"https://cdn.prod.website-files.com/66cdebdbbd868704132ec32f/673c805ce322ad4e4f4a0c5e_FD-logo_icon--coloured--250px.png","Order Office":"https://cdn.prod.website-files.com/66cdebdbbd868704132ec32f/673c809e757d3f3b9e945446_kesa%20emblem.png"},D={International:"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/672c93a99c106ad5d0006ad0_Warm%20Gradient%20Abstract%20ALT.avif",Local:"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/6728c5be93d6a63d4475aa46_Painting%203%20new.avif","Retreat/GFR":"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/67322b0aeb4ef255c66d5694_Painted%201.avif"},m={USD:{symbol:"$",display:"$USD",code:"USD"},NZD:{symbol:"$",display:"$NZD",code:"NZD"},AUD:{symbol:"$",display:"$AUD",code:"AUD"},MXN:{symbol:"$",display:"$MXN",code:"MXN"},GBP:{symbol:"Â£",display:"Â£GBP",code:"GBP"},EUR:{symbol:"â‚¬",display:"â‚¬EUR",code:"EUR"},INR:{symbol:"â‚¹",display:"â‚¹INR",code:"INR"}};function w(e){return m[e]?m[e]:Object.values(m).find(o=>o.symbol===e)||m.GBP}function y(){const e=localStorage.getItem("selectedCurrencyCode"),t=localStorage.getItem("selectedCurrencyDisplay"),o=localStorage.getItem("selectedCurrencySymbol");if(e&&t&&o)return{code:e,display:t,symbol:o};const n=m.GBP;return{code:n.code,display:n.display,symbol:n.symbol}}document.getElementById("email-form-2").addEventListener("keydown",e=>{e.key==="Enter"&&e.preventDefault()});function q(){if(!document.getElementById("max-charity-error")){const e=document.createElement("div");e.id="max-charity-error",e.className="text-size-medium text-align-center padding-small",Object.assign(e.style,{color:"white",backgroundColor:"#f85050",marginTop:"10px"}),e.textContent="You cannot add more than 7 charities. Please remove one before adding another.",document.getElementById("dragHeading")?.insertAdjacentElement("afterend",e)}}function L(){document.getElementById("max-charity-error")?.remove()}document.getElementById("calcBtn1").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection2").classList.remove("pledge-section-disabled","pledge-section-overlay");const t=document.getElementById("currencySelector").value,o=w(t);localStorage.setItem("selectedCurrencyCode",o.code),localStorage.setItem("selectedCurrencyDisplay",o.display),localStorage.setItem("selectedCurrencySymbol",o.symbol),F();const n=parseFloat(document.getElementById("monthlyIncome").value);if(isNaN(n)||n<=0)return alert("Please enter a valid monthly income.");let a=Math.round(n/21.67*2)/2;localStorage.setItem("dailyIncome",a.toFixed(2)),document.getElementById("s2-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s2-head").click();const{display:l}=y();document.getElementById("oneDayForYou").textContent=`${l}${a.toFixed(2)}`,p("1-Day",a,"1 Day",l),p("Half-Day",a/2,"1/2 Day",l),p("1.5-Days",a*1.5,"1.5 Days",l),p("2-Days",a*2,"2 Days",l);const c=document.getElementById("1-Day");c&&c.click(),document.getElementById("radio").checked||I("Order Office")});function F(){const{display:e}=y(),t=/(\$USD|\$NZD|\$AUD|\$MXN|Â£GBP|â‚¬EUR|â‚¹INR|[$Â£â‚¬â‚¹])/g;document.querySelectorAll(".amount-money, .total-gift-amount, #oneDayForYou, .w-form-label").forEach(o=>{o.textContent=(o.textContent||"").replace(t,e)})}function p(e,t,o,n){const a=Math.round(t*2)/2,l=document.getElementById(e),c=document.querySelector(`span[for='${e}']`);l&&c&&(l.dataset.amount=a,c.textContent=`${o} (${n}${a.toFixed(2)})`)}document.getElementById("calcBtn2").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection3").classList.remove("pledge-section-disabled","pledge-section-overlay");const t=document.querySelector("input[name='radioDayChoice']:checked");if(!t)return alert("Please select an amount to give.");const o=parseFloat(t.getAttribute("data-amount"));if(isNaN(o))return alert("Invalid amount selected. Please try again.");const n=document.getElementById("allocation-bar");if(!n){console.error("Element with ID 'allocation-bar' not found.");return}n.innerHTML="",n.dataset.totalAmount=o;const a=document.querySelector('input[type="checkbox"][data-item-name="Future Dharma"]');if(console.log("FD checkbox found?",a),a?(a.checked=!0,a.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0}))):console.warn("Couldn't find Future Dharma checkbox â€“ check your data-item-name!"),document.getElementsByName("radio")[0]?.checked){const c=document.querySelector('input[type="checkbox"][data-item-name="Order Office"]');c&&(c.checked=!0,c.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})))}f(),document.getElementById("s3-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s3-head").click()}),document.getElementById("calcBtn3").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection4").classList.remove("pledge-section-disabled","pledge-section-overlay");const t=document.getElementById("allocation-bar"),o=parseFloat(t.dataset.totalAmount);if(isNaN(o)||o<=0)return alert("Invalid pledge amount. Please ensure you have selected an amount to give.");const n=document.querySelectorAll(".allocation-section");if(n.length===0)return alert("Please add at least one charity to allocate your gift.");const{display:a}=y();let l=`
      <p>You are pledging to give <strong>${a}${o.toFixed(2)}</strong> each month, split across:</p>
      <table class="pledge-summary-table">
        <tr>
          <th>Charity</th>
          <th>Amount</th>
        </tr>`;const c=document.getElementById("wf-form-WADFTD-Pledge-Form-Final");if(!c){console.error("Pledge form not found!");return}document.querySelectorAll(".pledge-hidden-input").forEach(i=>i.remove());const d=document.createElement("input");d.type="hidden",d.name="TotalGift",d.value=o.toFixed(2),d.classList.add("pledge-hidden-input"),c.appendChild(d);let s=1;n.forEach(i=>{const h=i.querySelector(".allocator--charity-name").textContent.trim(),b=i.querySelector(".amount-money").textContent.trim();l+=`
        <tr>
          <td>${h}</td>
          <td>${b}</td>
        </tr>`;const u=document.createElement("input");u.type="hidden",u.name=`Charity${s}Name`,u.value=h,u.classList.add("pledge-hidden-input"),c.appendChild(u);const r=document.createElement("input");r.type="hidden",r.name=`Charity${s}Amount`,r.value=b,r.classList.add("pledge-hidden-input"),c.appendChild(r),s++}),l+="</table>",document.getElementById("pledge-summary").innerHTML=l,document.getElementById("s4-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s4-head").click()});function P(e){const t=e.value.toLowerCase();e.closest(".searchbar--container").querySelector(".autocomplete--list-container")?.querySelectorAll(".autocomplete--item").forEach(n=>{n.style.display=n.dataset.itemName.toLowerCase().includes(t)?"flex":"none"})}document.querySelectorAll(".searchbar").forEach(e=>{e.addEventListener("input",()=>P(e))}),document.querySelectorAll(".searchbar").forEach(e=>{const o=e.closest(".searchbar--container").querySelector(".autocomplete--list-container");function n(){o.style.maxHeight=o.scrollHeight+"px"}e.addEventListener("focus",n),e.addEventListener("click",n)}),document.addEventListener("click",e=>{e.target.closest(".searchbar--container")||document.querySelectorAll(".autocomplete--list-container").forEach(t=>t.style.maxHeight="0")}),document.addEventListener("change",e=>{const t=e.target;if(t.matches('input[type="checkbox"][data-item-name]')){const o=t.dataset.itemName,a=t.closest(".autocomplete--list-container")?.dataset.charityType||null;t.checked?M(o,a):I(o),f()}});function A(e){return e.replace(/\W+/g,"")}function M(e,t){const o=document.getElementById("allocation-bar");if(!o)return console.error("Allocation bar not found");if(o.querySelectorAll(".allocation-section").length>=7){q(),document.querySelector(`.autocomplete--checkbox[data-item-name="${e}"]`).checked=!1;return}L();const a=A(e);if(document.getElementById(`charity-${a}`))return;let l="";C[e]?l=`background-image:url('${C[e]}');`:t&&D[t]&&(l=`background-image:url('${D[t]}'); background-size:cover; background-position:center;`);const c=document.createElement("div");c.className="allocation-section",c.id=`charity-${a}`,c.innerHTML=`
      <div class="bar-slider--portion" style="${l}"></div>
      <div class="amounts-container">
        <div class="amount-percent text-size-medium center-this"></div>
        <div class="amount-money  text-size-medium center-this"></div>
        <a class="remove-charity w-button" data-charity-id="${e}">Remove</a>
      </div>
      <div class="allocator--charity-name">${e}</div>
    `,o.appendChild(c),f(),$()}function I(e){const t=A(e);document.getElementById(`charity-${t}`)?.remove();const o=document.querySelector(`.autocomplete--checkbox[data-item-name="${e}"]`);o&&(o.checked=!1),L(),f(),$()}document.getElementById("allocation-bar").addEventListener("click",function(e){if(e.target.classList.contains("remove-charity")){const t=e.target.dataset.charityId;I(t);const o=document.querySelector(`.autocomplete--checkbox[data-item-name="${t}"]`);o&&(o.checked=!1)}});function f(){console.log("ðŸ”„ updateTotal fired; sections =",document.querySelectorAll(".allocation-section").length);const e=document.getElementById("allocation-bar");parseFloat(e.dataset.totalAmount);const t=[...e.querySelectorAll(".allocation-section")];if(!t.length)return;let o=Math.round(100/t.length*100)/100,n=100-o*t.length;t.forEach((a,l)=>{let c=o;n>0?(c++,n--):n<0&&(c--,n++),a.style.width=c+"%",S(a)}),T()}function $(){console.log("ðŸ”§ rebuildBoundaryHandles invoked");const e=document.getElementById("allocation-bar");e.querySelectorAll(".boundary-handle").forEach(n=>n.remove());const t=[...e.querySelectorAll(".allocation-section")];if(t.length<2)return;let o=0;t.forEach((n,a)=>{const l=parseFloat(n.style.width)||0;if(o+=l,a<t.length-1){const c=document.createElement("div");c.className="boundary-handle",c.dataset.leftIndex=a,c.dataset.rightIndex=a+1,c.style.left=o+"%",e.appendChild(c)}}),G()}function R(){const e=document.getElementById("allocation-bar"),t=[...e.querySelectorAll(".allocation-section")],o=[...e.querySelectorAll(".boundary-handle")];let n=0;t.forEach((a,l)=>{const c=parseFloat(a.style.width)||0;n+=c,o[l]&&(o[l].style.left=n+"%")})}function G(){document.querySelectorAll(".boundary-handle").forEach(e=>{e.removeEventListener("mousedown",g),e.removeEventListener("touchstart",g),e.addEventListener("mousedown",g),e.addEventListener("touchstart",g,{passive:!1})})}function g(e){e.preventDefault();const t=e.target,o=document.getElementById("allocation-bar"),n=o.offsetWidth,a=+t.dataset.leftIndex,l=+t.dataset.rightIndex,c=[...o.querySelectorAll(".allocation-section")],d=c[a],s=c[l];let i=parseFloat(d.style.width)||0,h=parseFloat(s.style.width)||0;const b=i+h,u=(e.type==="touchstart"?e.touches[0]:e).clientX;function r(v){v.preventDefault();const k=((v.type==="touchmove"?v.touches[0]:v).clientX-u)/n*100;let B=Math.max(1,i+k),x=Math.max(1,h-k);const N=b/(B+x);B*=N,x*=N,d.style.width=B.toFixed(2)+"%",s.style.width=x.toFixed(2)+"%",S(d),S(s),R()}function E(){document.removeEventListener("mousemove",r),document.removeEventListener("touchmove",r),document.removeEventListener("mouseup",E),document.removeEventListener("touchend",E)}document.addEventListener("mousemove",r,{passive:!1}),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("mouseup",E),document.addEventListener("touchend",E)}function S(e){const t=document.getElementById("allocation-bar"),o=parseFloat(t.dataset.totalAmount)||0,{display:n}=y(),a=Math.round(parseFloat(e.style.width)||0),l=Math.round(a/100*o*2)/2;e.querySelector(".amount-percent").textContent=`${a}%`,e.querySelector(".amount-money").textContent=`${n}${l.toFixed(2)}`}function T(){const e=document.getElementById("allocation-bar"),t=parseFloat(e.dataset.totalAmount)||0,{display:o}=y();document.querySelector(".total-gift-amount").textContent=`${o}${t.toFixed(2)}`}});
