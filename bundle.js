const H="6432a90";console.log("ðŸ“¦ Script version (initial):",H);document.addEventListener("DOMContentLoaded",function(){["pledgeSection2","pledgeSection3","pledgeSection4"].forEach(e=>{const o=document.getElementById(e);o&&o.classList.add("pledge-section-disabled","pledge-section-overlay")});const C={"Future Dharma":"https://cdn.prod.website-files.com/66cdebdbbd868704132ec32f/673c805ce322ad4e4f4a0c5e_FD-logo_icon--coloured--250px.png","Order Office":"https://cdn.prod.website-files.com/66cdebdbbd868704132ec32f/673c809e757d3f3b9e945446_kesa%20emblem.png"},D={International:"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/672c93a99c106ad5d0006ad0_Warm%20Gradient%20Abstract%20ALT.avif",Local:"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/6728c5be93d6a63d4475aa46_Painting%203%20new.avif","Retreat/GFR":"https://cdn.prod.website-files.com/66cddc57f886c22c624244dc/67322b0aeb4ef255c66d5694_Painted%201.avif"},u={USD:{symbol:"$",display:"$USD",code:"USD"},NZD:{symbol:"$",display:"$NZD",code:"NZD"},AUD:{symbol:"$",display:"$AUD",code:"AUD"},MXN:{symbol:"$",display:"$MXN",code:"MXN"},GBP:{symbol:"Â£",display:"Â£GBP",code:"GBP"},EUR:{symbol:"â‚¬",display:"â‚¬EUR",code:"EUR"},INR:{symbol:"â‚¹",display:"â‚¹INR",code:"INR"}};function w(e){if(u[e])return u[e];if(/^[Â£â‚¬â‚¹$][A-Z]{3}$/.test(e)){const t=e.slice(1);if(u[t])return u[t]}return Object.values(u).find(t=>t.symbol===e)||u.GBP}function y(){const e=localStorage.getItem("selectedCurrencyCode"),o=localStorage.getItem("selectedCurrencyDisplay"),t=localStorage.getItem("selectedCurrencySymbol");if(e&&o&&t)return{code:e,display:o,symbol:t};const n=u.GBP;return{code:n.code,display:n.display,symbol:n.symbol}}document.getElementById("email-form-2").addEventListener("keydown",e=>{e.key==="Enter"&&e.preventDefault()});function F(){if(!document.getElementById("max-charity-error")){const e=document.createElement("div");e.id="max-charity-error",e.className="text-size-medium text-align-center padding-small",Object.assign(e.style,{color:"white",backgroundColor:"#f85050",marginTop:"10px"}),e.textContent="You cannot add more than 7 charities. Please remove one before adding another.",document.getElementById("dragHeading")?.insertAdjacentElement("afterend",e)}}function L(){document.getElementById("max-charity-error")?.remove()}document.getElementById("calcBtn1").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection2").classList.remove("pledge-section-disabled","pledge-section-overlay");const o=document.getElementById("currencySelector").value,t=w(o);localStorage.setItem("selectedCurrencyCode",t.code),localStorage.setItem("selectedCurrencyDisplay",t.display),localStorage.setItem("selectedCurrencySymbol",t.symbol),q();const n=parseFloat(document.getElementById("monthlyIncome").value);if(isNaN(n)||n<=0)return alert("Please enter a valid monthly income.");let c=Math.round(n/21.67*2)/2;localStorage.setItem("dailyIncome",c.toFixed(2)),document.getElementById("s2-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s2-head").click();const{symbol:l}=y();document.getElementById("oneDayForYou").textContent=`${l}${c.toFixed(2)}`,g("1-Day",c,"1 Day",l),g("Half-Day",c/2,"1/2 Day",l),g("1.5-Days",c*1.5,"1.5 Days",l),g("2-Days",c*2,"2 Days",l);const a=document.getElementById("1-Day");a&&a.click(),document.getElementById("radio").checked||I("Order Office")});function q(){const{symbol:e}=y(),o=/(\$USD|\$NZD|\$AUD|\$MXN|Â£GBP|â‚¬EUR|â‚¹INR|[$Â£â‚¬â‚¹])/g;document.querySelectorAll(".amount-money, .total-gift-amount, #oneDayForYou, .w-form-label").forEach(t=>{t.textContent=(t.textContent||"").replace(o,e)})}function g(e,o,t,n){const c=Math.round(o*2)/2,l=document.getElementById(e),a=document.querySelector(`span[for='${e}']`);l&&a&&(l.dataset.amount=c,a.textContent=`${t} (${n}${c.toFixed(2)})`)}document.getElementById("calcBtn2").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection3").classList.remove("pledge-section-disabled","pledge-section-overlay");const o=document.querySelector("input[name='radioDayChoice']:checked");if(!o)return alert("Please select an amount to give.");const t=parseFloat(o.getAttribute("data-amount"));if(isNaN(t))return alert("Invalid amount selected. Please try again.");const n=document.getElementById("allocation-bar");if(!n){console.error("Element with ID 'allocation-bar' not found.");return}n.innerHTML="",n.dataset.totalAmount=t;const c=document.querySelector('input[type="checkbox"][data-item-name="Future Dharma"]');if(console.log("FD checkbox found?",c),c?(c.checked=!0,c.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0}))):console.warn("Couldn't find Future Dharma checkbox â€“ check your data-item-name!"),document.getElementsByName("radio")[0]?.checked){const a=document.querySelector('input[type="checkbox"][data-item-name="Order Office"]');a&&(a.checked=!0,a.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})))}b(),document.getElementById("s3-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s3-head").click()}),document.getElementById("calcBtn3").addEventListener("click",function(e){e.preventDefault(),document.getElementById("pledgeSection4").classList.remove("pledge-section-disabled","pledge-section-overlay");const o=document.getElementById("allocation-bar"),t=parseFloat(o.dataset.totalAmount);if(isNaN(t)||t<=0)return alert("Invalid pledge amount. Please ensure you have selected an amount to give.");const n=document.querySelectorAll(".allocation-section");if(n.length===0)return alert("Please add at least one charity to allocate your gift.");const{display:c}=y();let l=`
      <p>You are pledging to give <strong>${c}${t.toFixed(2)}</strong> each month, split across:</p>
      <table class="pledge-summary-table">
        <tr>
          <th>Charity</th>
          <th>Amount</th>
        </tr>`;const a=document.getElementById("wf-form-WADFTD-Pledge-Form-Final");if(!a){console.error("Pledge form not found!");return}document.querySelectorAll(".pledge-hidden-input").forEach(p=>p.remove());const s=document.createElement("input");s.type="hidden",s.name="TotalGift",s.value=t.toFixed(2),s.classList.add("pledge-hidden-input"),a.appendChild(s);const{code:f}=y(),i=document.createElement("input");i.type="hidden",i.name="CurrencyCode",i.value=f,i.classList.add("pledge-hidden-input"),a.appendChild(i);let h=1;n.forEach(p=>{const v=p.querySelector(".allocator--charity-name").textContent.trim(),m=p.querySelector(".amount-money").textContent.trim();l+=`
        <tr>
          <td>${v}</td>
          <td>${m}</td>
        </tr>`;const r=document.createElement("input");r.type="hidden",r.name=`Charity${h}Name`,r.value=v,r.classList.add("pledge-hidden-input"),a.appendChild(r);const d=document.createElement("input");d.type="hidden",d.name=`Charity${h}Amount`,d.value=m,d.classList.add("pledge-hidden-input"),a.appendChild(d),h++}),l+="</table>",document.getElementById("pledge-summary").innerHTML=l,document.getElementById("s4-head").scrollIntoView({behavior:"smooth"}),document.getElementById("s4-head").click()});function P(e){const o=e.value.toLowerCase();e.closest(".searchbar--container").querySelector(".autocomplete--list-container")?.querySelectorAll(".autocomplete--item").forEach(n=>{n.style.display=n.dataset.itemName.toLowerCase().includes(o)?"flex":"none"})}document.querySelectorAll(".searchbar").forEach(e=>{e.addEventListener("input",()=>P(e))}),document.querySelectorAll(".searchbar").forEach(e=>{const t=e.closest(".searchbar--container").querySelector(".autocomplete--list-container");function n(){t.style.maxHeight=t.scrollHeight+"px"}e.addEventListener("focus",n),e.addEventListener("click",n)}),document.addEventListener("click",e=>{e.target.closest(".searchbar--container")||document.querySelectorAll(".autocomplete--list-container").forEach(o=>o.style.maxHeight="0")}),document.addEventListener("change",e=>{const o=e.target;if(o.matches('input[type="checkbox"][data-item-name]')){const t=o.dataset.itemName,c=o.closest(".autocomplete--list-container")?.dataset.charityType||null;o.checked?M(t,c):I(t),b()}});function A(e){return e.replace(/\W+/g,"")}function M(e,o){const t=document.getElementById("allocation-bar");if(!t)return console.error("Allocation bar not found");if(t.querySelectorAll(".allocation-section").length>=7){F(),document.querySelector(`.autocomplete--checkbox[data-item-name="${e}"]`).checked=!1;return}L();const c=A(e);if(document.getElementById(`charity-${c}`))return;let l="";C[e]?l=`background-image:url('${C[e]}');`:o&&D[o]&&(l=`background-image:url('${D[o]}'); background-size:cover; background-position:center;`);const a=document.createElement("div");a.className="allocation-section",a.id=`charity-${c}`,a.innerHTML=`
      <div class="bar-slider--portion" style="${l}"></div>
      <div class="amounts-container">
        <div class="amount-percent text-size-medium center-this"></div>
        <div class="amount-money  text-size-medium center-this"></div>
        <a class="remove-charity w-button" data-charity-id="${e}">Remove</a>
      </div>
      <div class="allocator--charity-name">${e}</div>
    `,t.appendChild(a),b(),$()}function I(e){const o=A(e);document.getElementById(`charity-${o}`)?.remove();const t=document.querySelector(`.autocomplete--checkbox[data-item-name="${e}"]`);t&&(t.checked=!1),L(),b(),$()}document.getElementById("allocation-bar").addEventListener("click",function(e){if(e.target.classList.contains("remove-charity")){const o=e.target.dataset.charityId;I(o);const t=document.querySelector(`.autocomplete--checkbox[data-item-name="${o}"]`);t&&(t.checked=!1)}});function b(){console.log("ðŸ”„ updateTotal fired; sections =",document.querySelectorAll(".allocation-section").length);const e=document.getElementById("allocation-bar");parseFloat(e.dataset.totalAmount);const o=[...e.querySelectorAll(".allocation-section")];if(!o.length)return;let t=Math.round(100/o.length*100)/100,n=100-t*o.length;o.forEach((c,l)=>{let a=t;n>0?(a++,n--):n<0&&(a--,n++),c.style.width=a+"%",S(c)}),T()}function $(){console.log("ðŸ”§ rebuildBoundaryHandles invoked");const e=document.getElementById("allocation-bar");e.querySelectorAll(".boundary-handle").forEach(n=>n.remove());const o=[...e.querySelectorAll(".allocation-section")];if(o.length<2)return;let t=0;o.forEach((n,c)=>{const l=parseFloat(n.style.width)||0;if(t+=l,c<o.length-1){const a=document.createElement("div");a.className="boundary-handle",a.dataset.leftIndex=c,a.dataset.rightIndex=c+1,a.style.left=t+"%",e.appendChild(a)}}),G()}function R(){const e=document.getElementById("allocation-bar"),o=[...e.querySelectorAll(".allocation-section")],t=[...e.querySelectorAll(".boundary-handle")];let n=0;o.forEach((c,l)=>{const a=parseFloat(c.style.width)||0;n+=a,t[l]&&(t[l].style.left=n+"%")})}function G(){document.querySelectorAll(".boundary-handle").forEach(e=>{e.removeEventListener("mousedown",E),e.removeEventListener("touchstart",E),e.addEventListener("mousedown",E),e.addEventListener("touchstart",E,{passive:!1})})}function E(e){e.preventDefault();const o=e.target,t=document.getElementById("allocation-bar"),n=t.offsetWidth,c=+o.dataset.leftIndex,l=+o.dataset.rightIndex,a=[...t.querySelectorAll(".allocation-section")],s=a[c],f=a[l];let i=parseFloat(s.style.width)||0,h=parseFloat(f.style.width)||0;const p=i+h,v=(e.type==="touchstart"?e.touches[0]:e).clientX;function m(d){d.preventDefault();const k=((d.type==="touchmove"?d.touches[0]:d).clientX-v)/n*100;let B=Math.max(1,i+k),x=Math.max(1,h-k);const N=p/(B+x);B*=N,x*=N,s.style.width=B.toFixed(2)+"%",f.style.width=x.toFixed(2)+"%",S(s),S(f),R()}function r(){document.removeEventListener("mousemove",m),document.removeEventListener("touchmove",m),document.removeEventListener("mouseup",r),document.removeEventListener("touchend",r)}document.addEventListener("mousemove",m,{passive:!1}),document.addEventListener("touchmove",m,{passive:!1}),document.addEventListener("mouseup",r),document.addEventListener("touchend",r)}function S(e){const o=document.getElementById("allocation-bar"),t=parseFloat(o.dataset.totalAmount)||0,{symbol:n}=y(),c=Math.round(parseFloat(e.style.width)||0),l=Math.round(c/100*t*2)/2;e.querySelector(".amount-percent").textContent=`${c}%`,e.querySelector(".amount-money").textContent=`${n}${l.toFixed(2)}`}function T(){const e=document.getElementById("allocation-bar"),o=parseFloat(e.dataset.totalAmount)||0,{symbol:t}=y();document.querySelector(".total-gift-amount").textContent=`${t}${o.toFixed(2)}`}});
